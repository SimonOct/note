# å¸¸ç”¨è½¯ä»¶

## è‡ªå¯åŠ¨

åˆ›å»ºå®¹å™¨æ—¶ï¼Œè®¾ç½®è‡ªåŠ¨å¯åŠ¨å®¹å™¨

```bash
docker run --restart=always å®¹å™¨idï¼ˆæˆ–è€…å®¹å™¨åç§°ï¼‰
```

å¦‚æœåˆ›å»ºæ—¶æœªæŒ‡å®š --restart=always ,å¯é€šè¿‡update å‘½ä»¤è®¾ç½®

```bash
docker update --restart=always  å®¹å™¨idï¼ˆæˆ–è€…å®¹å™¨åç§°ï¼‰
```

## MySQL

ä»¥mysql:8.0.28-oracleä¸ºä¾‹

```bash
docker run -p 3306:3306 --name mysql -v /usr/mydata/mysql/log:/var/log/mysql -v /usr/mydata/mysql/data:/var/lib/mysql -v /usr/mydata/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456 -d --name=mysql1 mysql:8.0.28-oracle --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
```

- --name mysql    å®¹å™¨åä¸º mysql
- -e MYSQL_ROOT_PASSWORD=123456    è®¾ç½®ç™»é™†å¯†ç ä¸º 123456ï¼Œç™»é™†ç”¨æˆ·ä¸º root
- -p 3306:3306    å°†å®¹å™¨å†…éƒ¨ 3306 ç«¯å£æ˜ å°„åˆ° ä¸»æœºçš„ 3306 ç«¯å£ï¼Œå³é€šè¿‡ ä¸»æœºçš„ 3306 å¯ä»¥è®¿é—®å®¹å™¨çš„ 3306 ç«¯å£
- -v /usr/mydata/mysql/log:/var/log/mysql    å°†å®¹å™¨çš„ æ—¥å¿—æ–‡ä»¶å¤¹ æŒ‚è½½åˆ° ä¸»æœºçš„ç›¸åº”ä½ç½®
- -v /usr/mydata/mysql/data:/var/lib/mysql    å°†å®¹å™¨çš„ æ•°æ®æ–‡ä»¶å¤¹ æŒ‚è½½åˆ° ä¸»æœºçš„ç›¸åº”ä½ç½®
- -v /usr/mydata/mysql/conf:/etc/mysql/conf.d    å°†å®¹å™¨çš„ è‡ªå®šä¹‰é…ç½®æ–‡ä»¶å¤¹ æŒ‚è½½åˆ°ä¸»æœºçš„ç›¸åº”ä½ç½®
- --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci    ä¸ä¿®æ”¹cnfé…ç½®æ–‡ä»¶çš„æƒ…å†µä¸‹æŒ‡å®šå­—ç¬¦é›†

å¦‚æœåœ¨å®¹å™¨å†…è¿æ¥MySQLæ—¶æŠ¥è¿™æ ·çš„é”™è¯¯

```bash
bash-4.4# mysql -uroot -p
Enter password:
ERROR 2002 (HY000): Can't connect to local MySQL server through socket '/var/lib/mysql/mysql.sock' (2)
```

ä½¿ç”¨`mysql -h 127.0.0.1 -uroot -p`è¿æ¥å³å¯

```bash
mysql> show variables like '%char%';
+--------------------------+--------------------------------+
| Variable_name            | Value                          |
+--------------------------+--------------------------------+
| character_set_client     | latin1                         |
| character_set_connection | latin1                         |
| character_set_database   | utf8mb4                        |
| character_set_filesystem | binary                         |
| character_set_results    | latin1                         |
| character_set_server     | utf8mb4                        |
| character_set_system     | utf8mb3                        |
| character_sets_dir       | /usr/share/mysql-8.0/charsets/ |
+--------------------------+--------------------------------+
8 rows in set (0.01 sec)
```

å®¢æˆ·ç«¯ä½¿ç”¨ä»€ä¹ˆå­—ç¬¦é›†çœ‹è¿æ¥å·¥å…·ï¼Œå¦‚æœæƒ³è¦å›ºå®šçš„è¯è¿˜æ˜¯éœ€è¦ä¿®æ”¹cnfé…ç½®æ–‡ä»¶

## PostgreSQL

```bash
docker run -d \
    -e POSTGRES_PASSWORD=123456 \
    -e PGDATA=/var/lib/postgresql/data/pgdata \
    -v /usr/pg/mount:/var/lib/postgresql/data \
    -p 5432:5432 \
    --name pg1 \
    postgres
```

cliè¿æ¥

åˆ‡æ¢postgresç”¨æˆ·åæ‰§è¡Œpsqlå³å¯

```bash
su - postgres
psql
```

```bash
postgres=# \l
                                 List of databases
   Name    |  Owner   | Encoding |  Collate   |   Ctype    |   Access privileges
-----------+----------+----------+------------+------------+-----------------------
 postgres  | postgres | UTF8     | en_US.utf8 | en_US.utf8 |
 template0 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
           |          |          |            |            | postgres=CTc/postgres
 template1 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
           |          |          |            |            | postgres=CTc/postgres
(3 rows)
```

æŠŠå®¹å™¨åˆ æ‰åå†æ–°å¯åŠ¨ä¸€ä¸ªï¼Œæ•°æ®ä¸ä¸¢å¤±

```bash
root@29f66d613797:/# su - postgres
postgres@29f66d613797:~$ psql
psql (14.1 (Debian 14.1-1.pgdg110+1))
Type "help" for help.

postgres=# \c test1
You are now connected to database "test1" as user "postgres".
test1=# select * from t1 ;
 id |    name
----+------------
  1 | simon
  2 | è¥¿è’™
  3 | ä¸œè’™ğŸ˜„
(3 rows)
```

